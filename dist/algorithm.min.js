/*!
 * 🔪 algorithm.js - 🔪 一些前端常用的算法实现合集。
 * git+https://github.com/hai2007/algorithm.js.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.3.0
 *
 * Copyright (c) 2020-present hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Mon Nov 23 2020 18:31:36 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function _typeof(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}function tree(e){var o=e||{},u,n;var l=function e(){var a=[],s=0,f=0;(function e(t,r){if(r>f)f=r;var n;for(n=0;n<t.children.length;n++){e(u[t.children[n]],r+1)}u[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;u[t.id].top=a[r]+1;var l=a[r]+1+(u[t.pid].children.length-1)*.5;if(l-1<a[r-1])u[t.id].top=a[r-1]+1-(u[t.pid].children.length-1)*.5}else{u[t.id].top=(u[t.children[0]].top+u[t.children[n-1]].top)*.5}if(u[t.id].top<=a[r]){var i=a[r]+1-u[t.id].top;(function e(t,r){u[t].top+=i;if(a[r]<u[t].top)a[r]=u[t].top;var n;for(n=0;n<u[t].children.length;n++){e(u[t].children[n],r+1)}})(t.id,r)}a[r]=u[t.id].top;if(u[t.id].top+.5>s)s=u[t.id].top+.5})(u[n],0);return{node:u,root:n,size:s,deep:f+1}};var i=function e(i){var a={};var t=o.root(i),s,r;s=r=o.id(t);a[s]={data:t,pid:null,id:s,children:[]};var f=1;(function e(t,r){var n=o.child(t,i),l;f+=n?n.length:0;for(l=0;n&&l<n.length;l++){s=o.id(n[l]);a[r].children.push(s);a[s]={data:n[l],pid:r,id:s,children:[]};e(n[l],s)}})(t,s);return{value:[r,a],num:f}};var t=function e(t){var r=i(t);u=r.value[1];n=r.value[0];if(r.num==1){u[n].left=.5;u[n].top=.5;return{deep:1,node:u,root:n,size:1}}return l()};t.root=function(e){o.root=e;return t};t.child=function(e){o.child=e;return t};t.id=function(e){o.id=e;return t};return t}var $RegExp={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var toString=Object.prototype.toString;function getType(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return toString.call(e)}function _isString(e){var t=_typeof(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&getType(e)==="[object String]"}var isUndefined=function e(t){return t===undefined};var isNull=function e(t){return t===null};var isString=_isString;function analyseTag(i){var a={},s=0;i=i.trim();var e=function e(){var t="",r="";for(;s<i.length;s++){if($RegExp.blanksReg.test(i[s])||s==i.length-1){t+=i[s];if(!$RegExp.blanksReg.test(t)){a[t.trim()]=""}s+=1;break}else if(i[s]=="="){s+=1;var n=null,l=-1;if(i.substr(s,1)=='"'||i.substr(s,1)=="'"){n=i.substr(s,1);l=1;s+=1}else if(i.substr(s,2)=='"'||i.substr(s,2)=="'"){n=i.substr(s,2);l=2;s+=2}if(n!==null){for(;s<i.length;s++){if(i.substr(s,l)==n){a[t.trim()]=r.trim();s+=2;break}else{r+=i[s]}}}else{for(;s<i.length;s++){if($RegExp.blanksReg.test(i[s])){a[t.trim()]=r.trim();s+=1;break}else{r+=i[s]}}}break}else{t+=i[s]}}if(s<i.length){e()}};e();return a}function nextTagFun(o){var u=-1,p=null;var g=false,d="";var h=["script","pre","style","code"];var c=function e(){p=u++<o.length-1?o[u]:null;return p};var v=function e(t){return o.substring(u,t+u>o.length?o.length:t+u)};c();while($RegExp.blankReg.test(p)&&u<o.length-1){c()}return function(){var e=p,t={};if(e==null)return null;if(g){t.type="textcode";t.tagName=e;while(v(d.length+3)!="</"+d+">"&&u<o.length){t.tagName+=c()}t.tagName=t.tagName.replace(/<$/,"");g=false;return t}if(v(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(v(3)!="--\x3e"&&u<o.length){t.tagName+=c()}c();c();c();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(v(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(v(1)!=">"&&u<o.length){t.tagName+=c()}c();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var r=false,n=null,l=null;while(r||p!=">"&&u<o.length){e+=c();if(r){var i=v(l+1).substring(1);if(i==n){r=false}}else{var a=v(2);if(a=='="'||a=="='"){n=a.replace("=","");l=1;r=true}a=v(3);if(a=='="'||a=="='"){n=a.replace("=","");l=2;r=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var s=0;for(;s<e.length;s++){if(e[s]==" ")break;t.tagName+=e[s]}var f=e.substring(s);if($RegExp.blanksReg.test(f)){t.attrs={}}else{t.attrs=analyseTag(f)}}}else{t.type="textcode";t.tagName=p;while(v(1)!="<"&&u<o.length){t.tagName+=c()}t.tagName=t.tagName.replace(/<$/,"");u-=1}if(t.type=="beginTag"){if(h.indexOf(t.tagName.toLowerCase())>-1){g=true;d=t.tagName}}else if(t.type=="endTag"){if(h.indexOf(t.tagName.toLowerCase())>-1){g=false}}c();return t}}function analyseDeep(e){e=closeTag(e);var t=0,r=[];e.forEach(function(e){if(e.type=="beginTag"){r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++t,__tagType__:"double"})}else if(e.type=="endTag"){t-=1}else if(e.type=="textcode"){r.push({type:"text",content:e.tagName,__deep__:t+1})}else if(e.type=="comment"){r.push({type:"comment",content:e.tagName,__deep__:t+1})}else{r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:t+1,__tagType__:"single"})}});return r}var closeTag=function e(n){var l=[];n.forEach(function(e,t){if(e.type=="beginTag"){l.push([t,e.tagName])}else if(e.type=="endTag"){while(l.length>0){var r=l.pop();if(r[1]==e.tagName){break}else{n[r[0]].type="fullTag"}}}});return n};function xhtmlToJson(e,t){if(!isString(e))throw new Error("Template must be a String!");var r=nextTagFun(e.trim());var n=r(),l=[];while(n!=null){if(n.type=="textcode"&&$RegExp.blanksReg.test(n.tagName));else if(n.type=="DOCTYPE");else if(n.type=="comment"){if(t){l.push(n)}}else{l.push(n)}n=r()}l=analyseDeep(l);var i=[null],a=0;for(var s=0;s<l.length;s++){var f=s,o=l[s].__deep__;l[s].childNodes=[];l[s].preNode=null;l[s].nextNode=null;var u=i[i.length-1];var p=i.length>1?i[i.length-2]:null;if(o==a){l[f].preNode=u;l[u].nextNode=f;l[f].parentNode=p;l[p].childNodes.push(f);i[i.length-1]=f}else if(o>a){l[f].parentNode=u;if(u!=null)l[u].childNodes.push(f);i.push(f)}else{var g=i[i.length-1-(a-o)];var d=i[i.length-2-(a-o)];l[f].preNode=g;if(g!=null)l[g].nextNode=f;l[f].parentNode=d;if(d!=null)l[d].childNodes.push(f);for(var h=0;h<a-o;h++){i.pop()}i[i.length-1]=f}a=o}return l}function analyseExpress(e,r,t){r=r.trim();var n=-1,l=null;var i=function e(){l=n++<r.length-1?r[n]:null;return l};var a=function e(t){return r.substring(n,t+n>r.length?r.length:t+n)};i();var s=[];while(true){if(n>=r.length)break;if(["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="].indexOf(l)>-1){if(["&","|","="].indexOf(l)>-1){if(["&&","||","=="].indexOf(a(2))>-1){s.push(a(2));n+=1;i()}else{throw new Error("Illegal expression : ".concat(r,"\nstep='analyseExpress',index=").concat(n))}}else{if([">=","<="].indexOf(a(2))>-1){s.push(a(2));n+=1;i()}else{s.push(l);i()}}}else if(['"',"'"].indexOf(l)>-1){var f="",o=l;i();while(l!=o){if(n>=r.length){throw new Error("String unclosed error : ".concat(r,"\nstep='analyseExpress',index=").concat(n))}f+=l;i()}s.push(f);i()}else if(/\d/.test(l)){var u="no";var p=l;i();while(n<r.length){if(/\d/.test(l)){p+=l;if(u=="error")u="yes"}else if("."==l&&u=="no"){p+=l;u="error"}else{break}i()}if(u=="error")p+="0";s.push(+p)}else if(["null","true"].indexOf(a(4))>-1){s.push({null:null,true:true}[a(4)]);n+=3;i()}else if(["false"].indexOf(a(5))>-1){s.push({false:false}[a(5)]);n+=4;i()}else if(["undefined"].indexOf(a(9))>-1){s.push({undefined:undefined}[a(9)]);n+=8;i()}else if($RegExp.blankReg.test(l)){do{i()}while($RegExp.blankReg.test(l)&&n<r.length)}else{var g=false;if(l=="."){g=true;i()}if($RegExp.identifier.test(l)){var d=1;while(n+d<=r.length&&$RegExp.identifier.test(a(d))){d+=1}if(g){s.push("[");s.push(a(d-1));s.push("]")}else{var h=a(d-1);s.push(h in t?t[h]:e[h])}n+=d-2;i()}else{throw new Error("Illegal express : ".concat(r,"\nstep='analyseExpress',index=").concat(n))}}}return s}function calcValue(expressArray){var express="";for(var i=0;i<expressArray.length;i++){if(isString(expressArray[i])&&["==","+","-","*","/","!"].indexOf(expressArray[i])<0)express+=JSON.stringify(expressArray[i]);else if(isNull(expressArray[i]))express+="null";else if(isUndefined(expressArray[i]))express+="undefined";else express+=expressArray[i]}console.log(express);return eval(express)}var doit1=function e(t,r,n){if(r.indexOf("(")>-1){var l=[],i=[],a=0;for(var s=0;s<r.length;s++){if(r[s]=="("){if(a>0){i.push("(")}a+=1}else if(r[s]==")"){if(a>1)i.push(")");a-=1;if(a==0){l.push(e(t,i));i=[]}}else{if(a>0)i.push(r[s]);else l.push(r[s])}}r=l}return doit2(t,r)};var doit2=function e(t,r,n){var l=true;while(l){l=false;var i=[],a=[],s=false;for(var f=0;f<r.length;f++){if(r[f]=="["&&f!=0&&r[f-1]!="]"){if(s){i.push("[");for(var o=0;o<a.length;o++){i.push(a[o])}a=[]}else{s=true}}else if(r[f]=="]"&&s){l=true;var u=calcValue(a);i[i.length-1]=i[i.length-1][u];s=false}else{if(s){a.push(r[f])}else{i.push(r[f])}}}r=i}};function toPath(e,t,r){var n=doit1(e,t);console.log(n)}var evalExpress=function e(t,r){};var getValue=function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var l=analyseExpress(t,r,n);var i=toPath(t,l)};var setValue=function e(t,r,n){};var algorithm={tree:tree,xhtmlToJson:xhtmlToJson,evalExpress:evalExpress,getValue:getValue,setValue:setValue};if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=algorithm}else{window.algorithm=algorithm}})();