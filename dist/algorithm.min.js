/*!
 * 🔪 algorithm.js - 🔪 一些前端常用的算法实现合集。
 * git+https://github.com/hai2007/algorithm.js.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.4.1
 *
 * Copyright (c) 2020-present hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Wed Nov 25 2020 11:51:44 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function r(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r=function(e){return typeof e}}else{r=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return r(e)}function f(e){return t(e)||n(e)||i(e)||a()}function t(e){if(Array.isArray(e))return l(e)}function n(e){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function i(e,t){if(!e)return;if(typeof e==="string")return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}function l(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function e(e){var o=e||{},u,n;var i=function e(){var a=[],f=0,s=0;(function e(t,r){if(r>s)s=r;var n;for(n=0;n<t.children.length;n++){e(u[t.children[n]],r+1)}u[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;u[t.id].top=a[r]+1;var i=a[r]+1+(u[t.pid].children.length-1)*.5;if(i-1<a[r-1])u[t.id].top=a[r-1]+1-(u[t.pid].children.length-1)*.5}else{u[t.id].top=(u[t.children[0]].top+u[t.children[n-1]].top)*.5}if(u[t.id].top<=a[r]){var l=a[r]+1-u[t.id].top;(function e(t,r){u[t].top+=l;if(a[r]<u[t].top)a[r]=u[t].top;var n;for(n=0;n<u[t].children.length;n++){e(u[t].children[n],r+1)}})(t.id,r)}a[r]=u[t.id].top;if(u[t.id].top+.5>f)f=u[t.id].top+.5})(u[n],0);return{node:u,root:n,size:f,deep:s+1}};var l=function e(l){var a={};var t=o.root(l),f,r;f=r=o.id(t);a[f]={data:t,pid:null,id:f,children:[]};var s=1;(function e(t,r){var n=o.child(t,l),i;s+=n?n.length:0;for(i=0;n&&i<n.length;i++){f=o.id(n[i]);a[r].children.push(f);a[f]={data:n[i],pid:r,id:f,children:[]};e(n[i],f)}})(t,f);return{value:[r,a],num:s}};var t=function e(t){var r=l(t);u=r.value[1];n=r.value[0];if(r.num==1){u[n].left=.5;u[n].top=.5;return{deep:1,node:u,root:n,size:1}}return i()};t.root=function(e){o.root=e;return t};t.child=function(e){o.child=e;return t};t.id=function(e){o.id=e;return t};return t}var y={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var s=Object.prototype.toString;function o(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return s.call(e)}function u(e){var t=r(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&o(e)==="[object String]"}var b=u;var g=function e(t){return Array.isArray(t)};function m(l){var a={},f=0;l=l.trim();var e=function e(){var t="",r="";for(;f<l.length;f++){if(y.blanksReg.test(l[f])||f==l.length-1){t+=l[f];if(!y.blanksReg.test(t)){a[t.trim()]=""}f+=1;break}else if(l[f]=="="){f+=1;var n=null,i=-1;if(l.substr(f,1)=='"'||l.substr(f,1)=="'"){n=l.substr(f,1);i=1;f+=1}else if(l.substr(f,2)=='"'||l.substr(f,2)=="'"){n=l.substr(f,2);i=2;f+=2}if(n!==null){for(;f<l.length;f++){if(l.substr(f,i)==n){a[t.trim()]=r.trim();f+=2;break}else{r+=l[f]}}}else{for(;f<l.length;f++){if(y.blanksReg.test(l[f])){a[t.trim()]=r.trim();f+=1;break}else{r+=l[f]}}}break}else{t+=l[f]}}if(f<l.length){e()}};e();return a}function d(o){var u=-1,g=null;var h=false,p="";var c=["script","pre","style","code"];var d=function e(){g=u++<o.length-1?o[u]:null;return g};var v=function e(t){return o.substring(u,t+u>o.length?o.length:t+u)};d();while(y.blankReg.test(g)&&u<o.length-1){d()}return function(){var e=g,t={};if(e==null)return null;if(h){t.type="textcode";t.tagName=e;while(v(p.length+3)!="</"+p+">"&&u<o.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");h=false;return t}if(v(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(v(3)!="--\x3e"&&u<o.length){t.tagName+=d()}d();d();d();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(v(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(v(1)!=">"&&u<o.length){t.tagName+=d()}d();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var r=false,n=null,i=null;while(r||g!=">"&&u<o.length){e+=d();if(r){var l=v(i+1).substring(1);if(l==n){r=false}}else{var a=v(2);if(a=='="'||a=="='"){n=a.replace("=","");i=1;r=true}a=v(3);if(a=='="'||a=="='"){n=a.replace("=","");i=2;r=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var f=0;for(;f<e.length;f++){if(e[f]==" ")break;t.tagName+=e[f]}var s=e.substring(f);if(y.blanksReg.test(s)){t.attrs={}}else{t.attrs=m(s)}}}else{t.type="textcode";t.tagName=g;while(v(1)!="<"&&u<o.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");u-=1}if(t.type=="beginTag"){if(c.indexOf(t.tagName.toLowerCase())>-1){h=true;p=t.tagName}}else if(t.type=="endTag"){if(c.indexOf(t.tagName.toLowerCase())>-1){h=false}}d();return t}}function v(e){e=h(e);var t=0,r=[];e.forEach(function(e){if(e.type=="beginTag"){r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++t,__tagType__:"double"})}else if(e.type=="endTag"){t-=1}else if(e.type=="textcode"){r.push({type:"text",content:e.tagName,__deep__:t+1})}else if(e.type=="comment"){r.push({type:"comment",content:e.tagName,__deep__:t+1})}else{r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:t+1,__tagType__:"single"})}});return r}var h=function e(n){var i=[];n.forEach(function(e,t){if(e.type=="beginTag"){i.push([t,e.tagName])}else if(e.type=="endTag"){while(i.length>0){var r=i.pop();if(r[1]==e.tagName){break}else{n[r[0]].type="fullTag"}}}});return n};function p(e,t){if(!b(e))throw new Error("Template must be a String!");var r=d(e.trim());var n=r(),i=[];while(n!=null){if(n.type=="textcode"&&y.blanksReg.test(n.tagName));else if(n.type=="DOCTYPE");else if(n.type=="comment"){if(t){i.push(n)}}else{i.push(n)}n=r()}i=v(i);var l=[null],a=0;for(var f=0;f<i.length;f++){var s=f,o=i[f].__deep__;i[f].childNodes=[];i[f].preNode=null;i[f].nextNode=null;var u=l[l.length-1];var g=l.length>1?l[l.length-2]:null;if(o==a){i[s].preNode=u;i[u].nextNode=s;i[s].parentNode=g;i[g].childNodes.push(s);l[l.length-1]=s}else if(o>a){i[s].parentNode=u;if(u!=null)i[u].childNodes.push(s);l.push(s)}else{var h=l[l.length-1-(a-o)];var p=l[l.length-2-(a-o)];i[s].preNode=h;if(h!=null)i[h].nextNode=s;i[s].parentNode=p;if(p!=null)i[p].childNodes.push(s);for(var c=0;c<a-o;c++){l.pop()}l[l.length-1]=s}a=o}return i}var x=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var N=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function c(e,r,t){r=r.trim();var n=-1,i=null;var l=function e(){i=n++<r.length-1?r[n]:null;return i};var a=function e(t){return r.substring(n,t+n>r.length?r.length:t+n)};l();var f=[];while(true){if(n>=r.length)break;if(x.indexOf(i)>-1){if(["&","|","="].indexOf(i)>-1){if(["==="].indexOf(a(3))>-1){f.push(a(3));n+=2;l()}else if(["&&","||","=="].indexOf(a(2))>-1){f.push(a(2));n+=1;l()}else{throw new Error("Illegal expression : ".concat(r,"\nstep='analyseExpress',index=").concat(n))}}else{if(["!=="].indexOf(a(3))>-1){f.push(a(3));n+=2;l()}else if([">=","<=","!="].indexOf(a(2))>-1){f.push(a(2));n+=1;l()}else{f.push(i);l()}}}else if(['"',"'"].indexOf(i)>-1){var s="",o=i;l();while(i!=o){if(n>=r.length){throw new Error("String unclosed error : ".concat(r,"\nstep='analyseExpress',index=").concat(n))}s+=i;l()}f.push(s+"@string");l()}else if(/\d/.test(i)){var u="no";var g=i;l();while(n<r.length){if(/\d/.test(i)){g+=i;if(u=="error")u="yes"}else if("."==i&&u=="no"){g+=i;u="error"}else{break}l()}if(u=="error")g+="0";f.push(+g)}else if(["null","true"].indexOf(a(4))>-1){f.push({null:null,true:true}[a(4)]);n+=3;l()}else if(["false"].indexOf(a(5))>-1){f.push({false:false}[a(5)]);n+=4;l()}else if(["undefined"].indexOf(a(9))>-1){f.push({undefined:undefined}[a(9)]);n+=8;l()}else if(y.blankReg.test(i)){do{l()}while(y.blankReg.test(i)&&n<r.length)}else{var h=false;if(i=="."){h=true;l()}if(y.identifier.test(i)){var p=1;while(n+p<=r.length&&y.identifier.test(a(p))){p+=1}if(h){f.push("[");f.push(a(p-1)+"@string");f.push("]")}else{var c=a(p-1);var d=c in t?t[c]:e[c];f.push(b(d)?d+"@string":d)}n+=p-2;l()}else{throw new Error("Illegal express : ".concat(r,"\nstep='analyseExpress',index=").concat(n))}}}var v=0;for(var m=0;m<f.length;m++){if(["+","-"].indexOf(f[m])>-1&&(m==0||N.indexOf(f[v-1])>-1)){f[v++]=+(f[m]+f[m+1]);m+=1}else{f[v++]=f[m]}}f.length=v;return f}var w=function e(t){if(typeof t=="string")return t.replace(/@string$/,"");return t};var _=function e(t){if(typeof t=="string")return t+"@string";return t};function O(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return w(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=w(e[t-1])*w(e[++r])}else if(e[r]=="/"){e[t-1]=w(e[t-1])/w(e[++r])}else if(e[r]=="%"){e[t-1]=w(e[t-1])%w(e[++r])}else{e[t++]=e[r]}}if(t==1)return w(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=_(w(e[t-1])+w(e[++r]))}else if(e[r]=="-"){e[t-1]=w(e[t-1])-w(e[++r])}else e[t++]=e[r]}if(t==1)return w(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=w(e[t-1])>w(e[++r])}else if(e[r]=="<"){e[t-1]=w(e[t-1])<w(e[++r])}else if(e[r]=="<="){e[t-1]=w(e[t-1])<=w(e[++r])}else if(e[r]==">="){e[t-1]=w(e[t-1])>=w(e[++r])}else e[t++]=e[r]}if(t==1)return w(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=w(e[t-1])==w(e[++r])}else if(e[r]=="==="){e[t-1]=w(e[t-1])===w(e[++r])}else if(e[r]=="!="){e[t-1]=w(e[t-1])!=w(e[++r])}else if(e[r]=="!=="){e[t-1]=w(e[t-1])!==w(e[++r])}else e[t++]=e[r]}if(t==1)return w(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=w(e[t-1])&&w(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=w(e[t-1])||w(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return w(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=w(e[t-1])?w(e[r+1]):w(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return w(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function E(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var i=1;i<r.length;i++){try{e=e[r[i]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:i});throw e}}return e}var T=function e(t,r,n){if(r.indexOf("(")>-1){var i=[],l=[],a=0;for(var f=0;f<r.length;f++){if(r[f]=="("){if(a>0){l.push("(")}a+=1}else if(r[f]==")"){if(a>1)l.push(")");a-=1;if(a==0){var s=O(e(t,l));i.push(b(s)?s+"@string":s);l=[]}}else{if(a>0)l.push(r[f]);else i.push(r[f])}}r=i}return k(r)};var k=function e(t){var r=true;while(r){r=false;var n=[],i=[],l=false;for(var a=0;a<t.length;a++){if(t[a]=="["&&a!=0&&t[a-1]!="]"){if(l){n.push("[");for(var f=0;f<i.length;f++){n.push(i[f])}}else{l=true}i=[]}else if(t[a]=="]"&&l){r=true;var s=O(i);var o=n[n.length-1][s];n[n.length-1]=b(o)?o+"@string":o;l=false}else{if(l){i.push(t[a])}else{n.push(t[a])}}}t=n}return t};var A=function e(t){var r=[],n=[];for(var i=0;i<t.length;i++){if(t[i]=="["){n=[]}else if(t[i]=="]"){r.push(O(n))}else{n.push(t[i])}}return r};function S(e,t,r){var n=T(e,t);var i;if(n[0]!="["){i=[O(n)]}else if(n[n.length-1]=="]"){i=A(n)}else{var l=n.lastIndexOf("]");var a=A(n.slice(0,l+1));i=[O([E(e,a,r)].concat(f(n.slice(l+1))))]}return i}var $=function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var i=c(t,r,n);console.log(i);var l=S(t,i,n);if(l.length>1)throw new Error("Illegal expression : ".concat(r,"\nstep='evalExpress',path=").concat(l,",expressArray=").concat(i));return l[0]};var j=function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var i=c(t,r,n);var l=S(t,i,n);return E(t,l,n)};var R=function e(t,r,n){var i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var l=c(t,r,i);var a=S(t,l,i);var f=t;for(var s=0;s<a.length-1;s++){if(!(a[s]in f))f[a[s]]=g(f)?[]:{};f=f[a[s]]}f[a[a.length-1]]=n;return t};var C={tree:e,xhtmlToJson:p,evalExpress:$,getValue:j,setValue:R};if((typeof module==="undefined"?"undefined":r(module))==="object"&&r(module.exports)==="object"){module.exports=C}else{window.algorithm=C}})();