/*!
 * 🔪 algorithm.js - 🔪 一些前端常用的算法实现合集。
 * git+https://github.com/hai2007/algorithm.js.git
 *
 * author hai2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.3.0
 *
 * Copyright (c) 2020-present hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Mon Nov 23 2020 13:57:10 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){n=function(e){return typeof e}}else{n=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return n(e)}function e(e){var f=e||{},u,r;var l=function e(){var a=[],o=0,s=0;(function e(t,n){if(n>s)s=n;var r;for(r=0;r<t.children.length;r++){e(u[t.children[r]],n+1)}u[t.id].left=n+.5;if(r==0){if(a[n]==undefined)a[n]=-.5;if(a[n-1]==undefined)a[n-1]=-.5;u[t.id].top=a[n]+1;var l=a[n]+1+(u[t.pid].children.length-1)*.5;if(l-1<a[n-1])u[t.id].top=a[n-1]+1-(u[t.pid].children.length-1)*.5}else{u[t.id].top=(u[t.children[0]].top+u[t.children[r-1]].top)*.5}if(u[t.id].top<=a[n]){var i=a[n]+1-u[t.id].top;(function e(t,n){u[t].top+=i;if(a[n]<u[t].top)a[n]=u[t].top;var r;for(r=0;r<u[t].children.length;r++){e(u[t].children[r],n+1)}})(t.id,n)}a[n]=u[t.id].top;if(u[t.id].top+.5>o)o=u[t.id].top+.5})(u[r],0);return{node:u,root:r,size:o,deep:s+1}};var i=function e(i){var a={};var t=f.root(i),o,n;o=n=f.id(t);a[o]={data:t,pid:null,id:o,children:[]};var s=1;(function e(t,n){var r=f.child(t,i),l;s+=r?r.length:0;for(l=0;r&&l<r.length;l++){o=f.id(r[l]);a[n].children.push(o);a[o]={data:r[l],pid:n,id:o,children:[]};e(r[l],o)}})(t,o);return{value:[n,a],num:s}};var t=function e(t){var n=i(t);u=n.value[1];r=n.value[0];if(n.num==1){u[r].left=.5;u[r].top=.5;return{deep:1,node:u,root:r,size:1}}return l()};t.root=function(e){f.root=e;return t};t.child=function(e){f.child=e;return t};t.id=function(e){f.id=e;return t};return t}var m={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var t=Object.prototype.toString;function r(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function l(e){var t=n(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&r(e)==="[object String]"}var h=l;function b(i){var a={},o=0;i=i.trim();var e=function e(){var t="",n="";for(;o<i.length;o++){if(m.blanksReg.test(i[o])||o==i.length-1){t+=i[o];if(!m.blanksReg.test(t)){a[t.trim()]=""}o+=1;break}else if(i[o]=="="){o+=1;var r=null,l=-1;if(i.substr(o,1)=='"'||i.substr(o,1)=="'"){r=i.substr(o,1);l=1;o+=1}else if(i.substr(o,2)=='"'||i.substr(o,2)=="'"){r=i.substr(o,2);l=2;o+=2}if(r!==null){for(;o<i.length;o++){if(i.substr(o,l)==r){a[t.trim()]=n.trim();o+=2;break}else{n+=i[o]}}}else{for(;o<i.length;o++){if(m.blanksReg.test(i[o])){a[t.trim()]=n.trim();o+=1;break}else{n+=i[o]}}}break}else{t+=i[o]}}if(o<i.length){e()}};e();return a}function v(f){var u=-1,p=null;var d=false,g="";var c=["script","pre","style","code"];var h=function e(){p=u++<f.length-1?f[u]:null;return p};var v=function e(t){return f.substring(u,t+u>f.length?f.length:t+u)};h();while(m.blankReg.test(p)&&u<f.length-1){h()}return function(){var e=p,t={};if(e==null)return null;if(d){t.type="textcode";t.tagName=e;while(v(g.length+3)!="</"+g+">"&&u<f.length){t.tagName+=h()}t.tagName=t.tagName.replace(/<$/,"");d=false;return t}if(v(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(v(3)!="--\x3e"&&u<f.length){t.tagName+=h()}h();h();h();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(v(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(v(1)!=">"&&u<f.length){t.tagName+=h()}h();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var n=false,r=null,l=null;while(n||p!=">"&&u<f.length){e+=h();if(n){var i=v(l+1).substring(1);if(i==r){n=false}}else{var a=v(2);if(a=='="'||a=="='"){r=a.replace("=","");l=1;n=true}a=v(3);if(a=='="'||a=="='"){r=a.replace("=","");l=2;n=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var o=0;for(;o<e.length;o++){if(e[o]==" ")break;t.tagName+=e[o]}var s=e.substring(o);if(m.blanksReg.test(s)){t.attrs={}}else{t.attrs=b(s)}}}else{t.type="textcode";t.tagName=p;while(v(1)!="<"&&u<f.length){t.tagName+=h()}t.tagName=t.tagName.replace(/<$/,"");u-=1}if(t.type=="beginTag"){if(c.indexOf(t.tagName.toLowerCase())>-1){d=true;g=t.tagName}}else if(t.type=="endTag"){if(c.indexOf(t.tagName.toLowerCase())>-1){d=false}}h();return t}}function y(e){e=i(e);var t=0,n=[];e.forEach(function(e){if(e.type=="beginTag"){n.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++t,__tagType__:"double"})}else if(e.type=="endTag"){t-=1}else if(e.type=="textcode"){n.push({type:"text",content:e.tagName,__deep__:t+1})}else if(e.type=="comment"){n.push({type:"comment",content:e.tagName,__deep__:t+1})}else{n.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:t+1,__tagType__:"single"})}});return n}var i=function e(r){var l=[];r.forEach(function(e,t){if(e.type=="beginTag"){l.push([t,e.tagName])}else if(e.type=="endTag"){while(l.length>0){var n=l.pop();if(n[1]==e.tagName){break}else{r[n[0]].type="fullTag"}}}});return r};function a(e,t){if(!h(e))throw new Error("Template must be a String!");var n=v(e.trim());var r=n(),l=[];while(r!=null){if(r.type=="textcode"&&m.blanksReg.test(r.tagName));else if(r.type=="DOCTYPE");else if(r.type=="comment"){if(t){l.push(r)}}else{l.push(r)}r=n()}l=y(l);var i=[null],a=0;for(var o=0;o<l.length;o++){var s=o,f=l[o].__deep__;l[o].childNodes=[];l[o].preNode=null;l[o].nextNode=null;var u=i[i.length-1];var p=i.length>1?i[i.length-2]:null;if(f==a){l[s].preNode=u;l[u].nextNode=s;l[s].parentNode=p;l[p].childNodes.push(s);i[i.length-1]=s}else if(f>a){l[s].parentNode=u;if(u!=null)l[u].childNodes.push(s);i.push(s)}else{var d=i[i.length-1-(a-f)];var g=i[i.length-2-(a-f)];l[s].preNode=d;if(d!=null)l[d].nextNode=s;l[s].parentNode=g;if(g!=null)l[g].childNodes.push(s);for(var c=0;c<a-f;c++){i.pop()}i[i.length-1]=s}a=f}return l}function o(e,n,t){n=n.trim();var r=-1,l=null;var i=function e(){l=r++<n.length-1?n[r]:null;return l};var a=function e(t){return n.substring(r,t+r>n.length?n.length:t+r)};i();var o=[];while(true){if(r>=n.length)break;if(["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="].indexOf(l)>-1){if(["&","|","="].indexOf(l)>-1){if(["&&","||","=="].indexOf(a(2))>-1){o.push(a(2));r+=1;i()}else{throw new Error("Illegal expression : ".concat(n,"\nstep='analyseExpress',index=").concat(r))}}else{if([">=","<="].indexOf(a(2))>-1){o.push(a(2));r+=1;i()}else{o.push(l);i()}}}else if(['"',"'"].indexOf(l)>-1){var s="",f=l;i();while(l!=f){if(r>=n.length){throw new Error("String unclosed error : ".concat(n,"\nstep='analyseExpress',index=").concat(r))}s+=l;i()}o.push(s);i()}else if(/\d/.test(l)){var u="no";var p=l;i();while(r<n.length){if(/\d/.test(l)){p+=l;if(u=="error")u="yes"}else if("."==l&&u=="no"){p+=l;u="error"}else{break}i()}if(u=="error")p+="0";o.push(+p)}else if(["null","true"].indexOf(a(4))>-1){o.push(a(4));r+=3;i()}else if(["false"].indexOf(a(5))>-1){o.push(a(5));r+=4;i()}else if(["undefined"].indexOf(a(9))>-1){o.push(a(9));r+=8;i()}else if(m.blankReg.test(l)){do{i()}while(m.blankReg.test(l)&&r<n.length)}else{var d=false;if(l=="."){d=true;i()}if(m.identifier.test(l)){var g=1;while(r+g<=n.length&&m.identifier.test(a(g))){g+=1}if(d){o.push("[");o.push(a(g-1));o.push("]")}else{var c=a(g-1);o.push(c in t?t[c]:e[c])}r+=g-2;i()}else{throw new Error("Illegal express : ".concat(n,"\nstep='analyseExpress',index=").concat(r))}}}return o}var s=function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var l=o(t,n,r);console.log(l)};var f=function e(t,n,r){};var u={tree:e,xhtmlToJson:a,getValue:s,setValue:f};if((typeof module==="undefined"?"undefined":n(module))==="object"&&n(module.exports)==="object"){module.exports=u}else{window.algorithm=u}})();