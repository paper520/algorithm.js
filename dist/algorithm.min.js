/*!
 * 🔪 algorithm.js - 🔪 一些前端常用的算法实现合集。
 * git+https://github.com/hai2007/algorithm.js.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 0.5.1
 *
 * Copyright (c) 2020-present hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Sat Jan 16 2021 11:56:30 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function e(e){var u=e||{},o,r;var n=function(){var a=[],f=0,s=0;(function e(t,r){if(r>s)s=r;var n;for(n=0;n<t.children.length;n++)e(o[t.children[n]],r+1);o[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;o[t.id].top=a[r]+1;var l=a[r]+1+(o[t.pid].children.length-1)*.5;if(l-1<a[r-1])o[t.id].top=a[r-1]+1-(o[t.pid].children.length-1)*.5}else{o[t.id].top=(o[t.children[0]].top+o[t.children[n-1]].top)*.5}if(o[t.id].top<=a[r]){var i=a[r]+1-o[t.id].top;(function e(t,r){o[t].top+=i;if(a[r]<o[t].top)a[r]=o[t].top;var n;for(n=0;n<o[t].children.length;n++){e(o[t].children[n],r+1)}})(t.id,r)}a[r]=o[t.id].top;if(o[t.id].top+.5>f)f=o[t.id].top+.5})(o[r],0);return{node:o,root:r,size:f,deep:s+1}};var l=function(i){var a={};var e=u.root(i),f,t;f=t=u.id(e);a[f]={data:e,pid:null,id:f,children:[]};var s=1;(function e(t,r){var n=u.child(t,i),l;s+=n?n.length:0;for(l=0;n&&l<n.length;l++){f=u.id(n[l]);a[r].children.push(f);a[f]={data:n[l],pid:r,id:f,children:[]};e(n[l],f)}})(e,f);return{value:[t,a],num:s}};var t=function(e){var t=l(e);o=t.value[1];r=t.value[0];if(t.num==1){o[r].left=.5;o[r].top=.5;return{deep:1,node:o,root:r,size:1}}return n()};t.root=function(e){u.root=e;return t};t.child=function(e){u.child=e;return t};t.id=function(e){u.id=e;return t};return t}var m={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var t=Object.prototype.toString;function r(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function n(e){var t=typeof e;return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&r(e)==="[object String]"}var x=n;var s=function(e){return Array.isArray(e)};function c(l){var i={},a=0;l=l.trim();var f=function(){var e="",t="";for(;a<l.length;a++){if(m.blanksReg.test(l[a])||a==l.length-1){e+=l[a];if(!m.blanksReg.test(e)){i[e.trim()]=""}a+=1;break}else if(l[a]=="="){a+=1;var r=null,n=-1;if(l.substr(a,1)=='"'||l.substr(a,1)=="'"){r=l.substr(a,1);n=1;a+=1}else if(l.substr(a,2)=='"'||l.substr(a,2)=="'"){r=l.substr(a,2);n=2;a+=2}if(r!==null){for(;a<l.length;a++){if(l.substr(a,n)==r){i[e.trim()]=t.trim();a+=2;break}else{t+=l[a]}}}else{for(;a<l.length;a++){if(m.blanksReg.test(l[a])){i[e.trim()]=t.trim();a+=1;break}else{t+=l[a]}}}break}else{e+=l[a]}}if(a<l.length){f()}};f();return i}function v(s){var u=-1,o=null;var g=false,h="";var p=["script","pre","style","code"];var d=function(){o=u++<s.length-1?s[u]:null;return o};var v=function(e){return s.substring(u,e+u>s.length?s.length:e+u)};d();while(m.blankReg.test(o)&&u<s.length-1)d();return function(){var e=o,t={};if(e==null)return null;if(g){t.type="textcode";t.tagName=e;while(v(h.length+3)!="</"+h+">"&&u<s.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");g=false;return t}if(v(4)=="\x3c!--"){t.type="comment";t.tagName=e;while(v(3)!="--\x3e"&&u<s.length){t.tagName+=d()}d();d();d();t.tagName=t.tagName.replace(/^<!--/,"").replace(/-$/,"");return t}if(v(9)=="<!DOCTYPE"){t.type="DOCTYPE";t.tagName=e;while(v(1)!=">"&&u<s.length){t.tagName+=d()}d();t.tagName=t.tagName.replace(/^<!DOCTYPE/,"").replace(/>$/,"");return t}else if(e=="<"){var r=false,n=null,l=null;while((r||o!=">")&&u<s.length){e+=d();if(r){var i=v(l+1).substring(1);if(i==n){r=false}}else{var i=v(2);if(i=='="'||i=="='"){n=i.replace("=","");l=1;r=true}i=v(3);if(i=='="'||i=="='"){n=i.replace("=","");l=2;r=true}}}if(/^<\//.test(e)){t.tagName=e.replace(/^<\//,"").replace(/>$/,"");t.type="endTag"}else{if(/\/>$/.test(e)){t.type="fullTag";e=e.replace(/\/>$/,"")}else{t.type="beginTag";e=e.replace(/>$/,"")}e=e.replace(/^</,"");t.tagName="";var a=0;for(;a<e.length;a++){if(e[a]==" ")break;t.tagName+=e[a]}var f=e.substring(a);if(m.blanksReg.test(f)){t.attrs={}}else{t.attrs=c(f)}}}else{t.type="textcode";t.tagName=o;while(v(1)!="<"&&u<s.length){t.tagName+=d()}t.tagName=t.tagName.replace(/<$/,"");u-=1}if(t.type=="beginTag"){if(p.indexOf(t.tagName.toLowerCase())>-1){g=true;h=t.tagName}}else if(t.type=="endTag"){if(p.indexOf(t.tagName.toLowerCase())>-1){g=false}}d();return t}}function y(e){e=l(e);var t=0,r=[];e.forEach(function(e){if(e.type=="beginTag"){r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:++t,__tagType__:"double"})}else if(e.type=="endTag"){t-=1}else if(e.type=="textcode"){r.push({type:"text",content:e.tagName,__deep__:t+1})}else if(e.type=="comment"){r.push({type:"comment",content:e.tagName,__deep__:t+1})}else{r.push({type:"tag",name:e.tagName,attrs:e.attrs,__deep__:t+1,__tagType__:"single"})}});return r}var l=function(n){var l=[];n.forEach(function(e,t){if(e.type=="beginTag"){l.push([t,e.tagName])}else if(e.type=="endTag"){while(l.length>0){var r=l.pop();if(r[1]==e.tagName){break}else{n[r[0]].type="fullTag"}}}});return n};function i(e,t){if(!x(e))throw new Error("Template must be a String!");var r=v(e.trim());var n=r(),l=[];while(n!=null){if(n.type=="textcode"&&m.blanksReg.test(n.tagName));else if(n.type=="DOCTYPE");else if(n.type=="comment"){if(t){l.push(n)}}else{l.push(n)}n=r()}l=y(l);var i=[null],a=0;for(var f=0;f<l.length;f++){var s=f,u=l[f].__deep__;l[f].childNodes=[];l[f].preNode=null;l[f].nextNode=null;var o=i[i.length-1];var g=i.length>1?i[i.length-2]:null;if(u==a){l[s].preNode=o;l[o].nextNode=s;l[s].parentNode=g;l[g].childNodes.push(s);i[i.length-1]=s}else if(u>a){l[s].parentNode=o;if(o!=null)l[o].childNodes.push(s);i.push(s)}else{var h=i[i.length-1-(a-u)];var p=i[i.length-2-(a-u)];l[s].preNode=h;if(h!=null)l[h].nextNode=s;l[s].parentNode=p;if(p!=null)l[p].childNodes.push(s);for(var d=0;d<a-u;d++){i.pop()}i[i.length-1]=s}a=u}return l}var N=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var b=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function u(e,t,r){t=t.trim();var n=-1,l=null;var i=function(){l=n++<t.length-1?t[n]:null;return l};var a=function(e){return t.substring(n,e+n>t.length?t.length:e+n)};i();var f=[];while(true){if(n>=t.length)break;if(N.indexOf(l)>-1){if(["&","|","="].indexOf(l)>-1){if(["==="].indexOf(a(3))>-1){f.push(a(3));n+=2;i()}else if(["&&","||","=="].indexOf(a(2))>-1){f.push(a(2));n+=1;i()}else{throw new Error("Illegal expression : "+t+"\nstep='analyseExpress',index="+n)}}else{if(["!=="].indexOf(a(3))>-1){f.push(a(3));n+=2;i()}else if([">=","<=","!="].indexOf(a(2))>-1){f.push(a(2));n+=1;i()}else{f.push(l);i()}}}else if(['"',"'"].indexOf(l)>-1){var s="",u=l;i();while(l!=u){if(n>=t.length){throw new Error("String unclosed error : "+t+"\nstep='analyseExpress',index="+n)}s+=l;i()}f.push(s+"@string");i()}else if(/\d/.test(l)){var o="no";var s=l;i();while(n<t.length){if(/\d/.test(l)){s+=l;if(o=="error")o="yes"}else if("."==l&&o=="no"){s+=l;o="error"}else{break}i()}if(o=="error")s+="0";f.push(+s)}else if(["null","true"].indexOf(a(4))>-1){f.push({null:null,true:true}[a(4)]);n+=3;i()}else if(["false"].indexOf(a(5))>-1){f.push({false:false}[a(5)]);n+=4;i()}else if(["undefined"].indexOf(a(9))>-1){f.push({undefined:undefined}[a(9)]);n+=8;i()}else if(m.blankReg.test(l)){do{i()}while(m.blankReg.test(l)&&n<t.length)}else{var g=false;if(l=="."){g=true;i()}if(m.identifier.test(l)){var h=1;while(n+h<=t.length&&m.identifier.test(a(h)))h+=1;if(g){f.push("[");f.push(a(h-1)+"@string");f.push("]")}else{var p=a(h-1);var d=p in r?r[p]:e[p];f.push(x(d)?d+"@string":d)}n+=h-2;i()}else{throw new Error("Illegal express : "+t+"\nstep='analyseExpress',index="+n)}}}var v=0;for(var c=0;c<f.length;c++){if(["+","-"].indexOf(f[c])>-1&&(c==0||b.indexOf(f[v-1])>-1)){f[v++]=+(f[c]+f[c+1]);c+=1}else{f[v++]=f[c]}}f.length=v;return f}var a=function(e){if(typeof e=="string")return e.replace(/@string$/,"");return e};var f=function(e){if(typeof e=="string")return e+"@string";return e};function o(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return a(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=a(e[t-1])*a(e[++r])}else if(e[r]=="/"){e[t-1]=a(e[t-1])/a(e[++r])}else if(e[r]=="%"){e[t-1]=a(e[t-1])%a(e[++r])}else{e[t++]=e[r]}}if(t==1)return a(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=f(a(e[t-1])+a(e[++r]))}else if(e[r]=="-"){e[t-1]=a(e[t-1])-a(e[++r])}else e[t++]=e[r]}if(t==1)return a(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=a(e[t-1])>a(e[++r])}else if(e[r]=="<"){e[t-1]=a(e[t-1])<a(e[++r])}else if(e[r]=="<="){e[t-1]=a(e[t-1])<=a(e[++r])}else if(e[r]==">="){e[t-1]=a(e[t-1])>=a(e[++r])}else e[t++]=e[r]}if(t==1)return a(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=a(e[t-1])==a(e[++r])}else if(e[r]=="==="){e[t-1]=a(e[t-1])===a(e[++r])}else if(e[r]=="!="){e[t-1]=a(e[t-1])!=a(e[++r])}else if(e[r]=="!=="){e[t-1]=a(e[t-1])!==a(e[++r])}else e[t++]=e[r]}if(t==1)return a(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=a(e[t-1])&&a(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=a(e[t-1])||a(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return a(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=a(e[t-1])?a(e[r+1]):a(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return a(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function g(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var l=1;l<r.length;l++){try{e=e[r[l]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:l});throw e}}return e}var h=function(e,t,r){if(t.indexOf("(")>-1){var n=[],l=[],i=0;for(var a=0;a<t.length;a++){if(t[a]=="("){if(i>0){l.push("(")}i+=1}else if(t[a]==")"){if(i>1)l.push(")");i-=1;if(i==0){var f=o(h(e,l));n.push(x(f)?f+"@string":f);l=[]}}else{if(i>0)l.push(t[a]);else n.push(t[a])}}t=n}return p(t)};var p=function(e){var t=true;while(t){t=false;var r=[],n=[],l=false;for(var i=0;i<e.length;i++){if(e[i]=="["&&i!=0&&e[i-1]!="]"){if(l){r.push("[");for(var a=0;a<n.length;a++)r.push(n[a])}else{l=true}n=[]}else if(e[i]=="]"&&l){t=true;var f=o(n);var s=r[r.length-1][f];r[r.length-1]=x(s)?s+"@string":s;l=false}else{if(l){n.push(e[i])}else{r.push(e[i])}}}e=r}return e};var d=function(e){var t=[],r=[];for(var n=0;n<e.length;n++){if(e[n]=="["){r=[]}else if(e[n]=="]"){t.push(o(r))}else{r.push(e[n])}}return t};function w(e,t,r){var n=h(e,t);var l;if(n[0]!="["){l=[o(n)]}else if(n[n.length-1]=="]"){l=d(n)}else{var i=n.lastIndexOf("]");var a=d(n.slice(0,i+1));var f=n.slice(i+1);f.unshift(g(e,a,r));l=[o(f)]}return l}var _=function(e,t,r){if(arguments.length<3)r={};var n=u(e,t,r);var l=w(e,n,r);if(l.length>1)throw new Error("Illegal expression : "+t+"\nstep='evalExpress',path="+l+",expressArray="+n);return l[0]};var O=function(e,t,r){if(arguments.length<3)r={};var n=u(e,t,r);var l=w(e,n,r);return g(e,l,r)};var k=function(e,t,r,n){if(arguments.length<3)n={};var l=u(e,t,n);var i=w(e,l,n);var a=e;for(var f=0;f<i.length-1;f++){if(!(i[f]in a))a[i[f]]=s(a)?[]:{};a=a[i[f]]}a[i[i.length-1]]=r;return e};var E={tree:e,xhtmlToJson:i,evalExpress:_,getValue:O,setValue:k};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=E}else{window.algorithm=E}})();